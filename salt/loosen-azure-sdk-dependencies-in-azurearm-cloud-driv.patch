From 315480867118e56d8960d4e81899a3bf365fe0d6 Mon Sep 17 00:00:00 2001
From: Joachim Gleissner <jgleissner@suse.com>
Date: Tue, 18 Sep 2018 15:07:13 +0200
Subject: [PATCH] loosen azure sdk dependencies in azurearm cloud driver

Remove dependency to azure-cli, which is not used at all.
Use azure-storage-sdk as fallback if multiapi version is not available.

remove unused import from azurearm driver
---
 salt/cloud/clouds/azurearm.py | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/salt/cloud/clouds/azurearm.py b/salt/cloud/clouds/azurearm.py
index b85265844f..bad4dbdfb0 100644
--- a/salt/cloud/clouds/azurearm.py
+++ b/salt/cloud/clouds/azurearm.py
@@ -102,6 +102,7 @@ import logging
 import os
 import os.path
 import pprint
+import pkgutil
 import string
 import time
 
@@ -114,6 +115,7 @@ import salt.utils.cloud
 import salt.utils.files
 import salt.utils.stringutils
 import salt.utils.yaml
+from salt.ext import six
 import salt.version
 from salt.exceptions import (
     SaltCloudConfigError,
@@ -153,6 +155,11 @@ try:
         PublicIPAddress,
     )
     from msrestazure.azure_exceptions import CloudError
+    if pkgutil.find_loader('azure.multiapi'):
+        # use multiapi version if available
+        from azure.multiapi.storage.v2016_05_31 import CloudStorageAccount
+    else:
+        from azure.storage import CloudStorageAccount
     HAS_LIBS = True
 except ImportError:
     pass
-- 
2.17.1


